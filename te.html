<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>On-Scroll Gooey Overlay (WebGL + GSAP ScrollTrigger)</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      font-size: 20px;
      background-color: #F8F8FF;
    }

    a {
      color: inherit;
    }

    .page {
      width: 100%;
      min-height: 1500px;
      display: flex;
      flex-direction: column;
      align-items: center;
      opacity: 0;
    }

    .text-overlay,
    .scroll-msg {
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .scroll-msg {
      margin-top: 2em;
      pointer-events: none;
    }

    .scroll-msg > div:nth-child(1) {
      margin-top: -10vh;
      padding-bottom: 1em;
      text-transform: uppercase;
      font-size: 2em;
    }

    .text-overlay {
      position: fixed;
      top: 0;
      left: 0;
      opacity: 0;
    }

    canvas#gooey-overlay {
      position: fixed;
      top: 0;
      left: 0;
      display: block;
      width: 100%;
      pointer-events: none;
    }

    .arrow-animated {
      font-size: 1em;
      animation: arrow-float 1s infinite;
    }

    @keyframes arrow-float {
      0% { transform: translateY(0); animation-timing-function: ease-out; }
      60% { transform: translateY(50%); animation-timing-function: ease-in-out; }
      100% { transform: translateY(0); animation-timing-function: ease-out; }
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="scroll-msg">
      <div>Hello ðŸ‘‹</div>
      <div>scroll me</div>
      <div class="arrow-animated-wrapper">
        <div class="arrow-animated">&darr;</div>
      </div>
    </div>
  </div>
  <canvas id="gooey-overlay"></canvas>
  <div class="text-overlay">
    <p>
      <a href="https://linkedin.com/in/ksenia-kondrashova/" target="_blank">linkedIn</a> |
      <a href="https://codepen.io/ksenia-k" target="_blank">codepen</a> |
      <a href="https://twitter.com/uuuuuulala" target="_blank">twitter (X)</a>
    </p>
  </div>

  <script type="x-shader/x-fragment" id="vertShader">
    precision mediump float;
    varying vec2 vUv;
    attribute vec2 a_position;
    void main() {
        vUv = a_position;
        gl_Position = vec4(a_position, 0.0, 1.0);
    }
  </script>

  <script type="x-shader/x-fragment" id="fragShader">
    precision mediump float;
    varying vec2 vUv;
    uniform float u_time;
    uniform float u_scroll_progr;
    uniform float u_col_width;
    uniform float u_scale;
    uniform float u_speed;
    uniform float u_seed;
    uniform vec3 u_color;
    uniform vec2 u_resolution;

    float random(vec2 st) {
      return fract(sin(dot(st.xy,
                           vec2(12.9898,78.233)))
                   * 43758.5453123);
    }

    float noise(vec2 st) {
      vec2 i = floor(st);
      vec2 f = fract(st);

      float a = random(i);
      float b = random(i + vec2(1.0, 0.0));
      float c = random(i + vec2(0.0, 1.0));
      float d = random(i + vec2(1.0, 1.0));

      vec2 u = f*f*(3.0-2.0*f);

      return mix(a, b, u.x) +
              (c - a)* u.y * (1.0 - u.x) +
              (d - b) * u.x * u.y;
    }

    void main() {
      vec2 st = vUv * vec2(u_resolution.x / u_resolution.y, 1.0);
      vec2 grid = vec2(u_col_width, u_col_width);
      st /= grid;
      vec2 id = floor(st);
      st = fract(st);

      float n = noise(id * u_seed + u_time * u_speed);
      float mask = step(0.2, 0.5 + 0.5 * sin(n * 6.2831));

      float dist = length(st - 0.5);
      float circle = smoothstep(0.25 * u_scale, 0.24 * u_scale, dist);

      vec3 color = mix(vec3(0.0), u_color, circle * mask * u_scroll_progr);
      gl_FragColor = vec4(color, 1.0);
    }
  </script>

  <script src='https://unpkg.com/gsap@3/dist/gsap.min.js'></script>
  <script src='https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js'></script>

  <script type="module">
    const canvasEl = document.querySelector("#gooey-overlay");
    const contentEl = document.querySelector(".text-overlay");
    const scrollMsgEl = document.querySelector(".scroll-msg");
    const scrollArrowEl = document.querySelector(".arrow-animated-wrapper");

    const devicePixelRatio = Math.min(window.devicePixelRatio, 2);

    const params = {
      scrollProgress: 0,
      colWidth: 0.9,
      speed: 0.3,
      scale: 0.25,
      seed: 0.231,
      color: [145 / 255, 1 / 255, 223 / 255]
    };

    let st, uniforms;
    const gl = initShader();

    st = gsap.timeline({
      scrollTrigger: {
        trigger: ".page",
        start: "0% 0%",
        end: "100% 100%",
        scrub: true
      }
    })
      .to(params, { scrollProgress: 1 }, 0)
      .to(scrollArrowEl, { duration: 0.2, y: 50, opacity: 0 }, 0)
      .to(scrollMsgEl, { opacity: 0 }, 0)
      .to(contentEl, { duration: 0.3, opacity: 1 }, 0.5)
      .progress(0);

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();
    render();

    gsap.set(".page", { opacity: 1 });

    function initShader() {
      const vsSource = document.getElementById("vertShader").innerHTML;
      const fsSource = document.getElementById("fragShader").innerHTML;
      const gl = canvasEl.getContext("webgl") || canvasEl.getContext("experimental-webgl");

      const shader = (source, type) => {
        const s = gl.createShader(type);
        gl.shaderSource(s, source);
        gl.compileShader(s);
        return s;
      };

      const vertexShader = shader(vsSource, gl.VERTEX_SHADER);
      const fragmentShader = shader(fsSource, gl.FRAGMENT_SHADER);
      const program = gl.createProgram();
      gl.attachShader(program, vertexShader);
      gl.attachShader(program, fragmentShader);
      gl.linkProgram(program);
      gl.useProgram(program);

      uniforms = {};
      const uniformCount = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);
      for (let i = 0; i < uniformCount; i++) {
        const name = gl.getActiveUniform(program, i).name;
        uniforms[name] = gl.getUniformLocation(program, name);
      }

      const vertices = new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]);
      const vertexBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
      gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
      const posLoc = gl.getAttribLocation(program, "a_position");
      gl.enableVertexAttribArray(posLoc);
      gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);

      gl.uniform1f(uniforms.u_col_width, params.colWidth);
      gl.uniform1f(uniforms.u_speed, params.speed);
      gl.uniform1f(uniforms.u_scale, params.scale);
      gl.uniform1f(uniforms.u_seed, params.seed);
      gl.uniform3f(uniforms.u_color, params.color[0], params.color[1], params.color[2]);

      return gl;
    }

    function render() {
      const currentTime = performance.now();
      gl.uniform1f(uniforms.u_time, currentTime);
      gl.uniform1f(uniforms.u_scroll_progr, params.scrollProgress);
      gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
      requestAnimationFrame(render);
    }

    function resizeCanvas() {
      canvasEl.width = window.innerWidth * devicePixelRatio;
      canvasEl.height = window.innerHeight * devicePixelRatio;
      gl.viewport(0, 0, canvasEl.width, canvasEl.height);
      gl.uniform2f(uniforms.u_resolution, canvasEl.width, canvasEl.height);
    }
  </script>
</body>

</html>
